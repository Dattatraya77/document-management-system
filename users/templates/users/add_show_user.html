{% extends "layout1.html" %}
{% load crispy_forms_tags %}
{% load static %}
{% block content %}

<style>
    .container-fluid {
        padding-right: 15px !important;
        padding-left: 0px !important;
    }
    .select2-container .select2-selection--multiple {
        width : 310px;
        border-color: #007bff;
        min-height : 37px;
    }
    .select.form-control[multiple], select.form-control[size] {
        height : auto !important;
    }
</style>

<body class="" style="background-color: #fafafa;">
    <div class="container">
        <div class="row">
            <div class="col-sm-4 pt-5">
                <h4 class="text-center alert alert-info">
                    Create New User
                </h4>

                {% if user_form.errors %}
                    {% for field in user_form %}
                        {% for error in field.errors %}
                            <div class="alert alert-danger alert-dismissible" role="alert">
                                <button type="button" class="close" data-dismiss="alert">&times;</button>
                                <strong>{{ error|escape }}</strong>
                            </div>
                        {% endfor %}
                    {% endfor %}
                    {% for error in user_form.non_field_errors %}
                        <div class="alert alert-danger alert-dismissible" role="alert">
                            <button type="button" class="close" data-dismiss="alert">&times;</button>
                            <strong>{{ error|escape }}</strong>
                        </div>
                    {% endfor %}
                {% endif %}

                <form method="POST" enctype="multipart/form-data" class="mt-3">
                    {% csrf_token %}
                    <div class="form-group">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">
                                    <span class="fa fa-user"></span>
                                </span>
                            </div>
                            {{ user_form.username }}
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">
                                    <span class="fa fa-envelope">
                                    </span>
                                </span>
                            </div>
                            {{ user_form.email }}
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">
                                    <span class="fa fa-lock">
                                    </span>
                                </span>
                            </div>
                            {{ user_form.password1 }}
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">
                                    <span class="fa fa-lock">
                                    </span>
                                </span>
                            </div>
                            {{ user_form.password2 }}
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <div class="row" style="width:100%;display:flex;justify-content:space-between;">
                                <div class="col">
                                    <div class="row">
                                        <p style="padding:0px;margin:0px;margin-left:20px;" id="show_hide_text_at_register_page">Show password</p>
                                        <input   style="padding:0px;margin:0px;width:13px;height:13px;margin-left:10px;margin-top:7px;" type="checkbox" onclick="show_hide_passowrd_in_register_page(this)">
                                    </div>
                                </div>
                                <div class="col">

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">
                                    <span class="fas fa-layer-group">
                                    </span>
                                </span>
                            </div>
                            {{ user_form.groups }}
<!--                            <select multiple class="multiple-select" name="group_select">-->
<!--                                {% for group in groups %}-->
<!--                                    <option value="{{ group.name }}" class="form-control">{{ group.name }}</option>-->
<!--                                {% endfor %}-->
<!--                            </select>-->
                        </div>
                    </div>


                    <div class="form-group">
                        <button class="btn btn-primary btn-block" type="submit">Create</button>
                    </div>
                </form>
            </div>

            <div class="col-sm-8 pt-5">
                <h4 class="text-center alert alert-info">
                    Show User Information
                </h4>
                <div class="table-responsive">
                    <table id="example" class="table table-bordered table-striped" data-order='[[ 0, "desc" ]]'>
                        <thead>
                            <tr align="center">
                                <th>ID</th>
                                <th>Username</th>
                                <th>Action</th>
                                <th hidden>ID</th>
                                <th hidden>ID</th>
                                <th hidden>ID</th>
                            </tr>
                        </thead>

                        <tbody>
                            {% for item in users_groups_data %}
                                <tr align="center">
                                    <td>{{ item.user.id }}</td>
                                    <td>{{ item.user.username }}</td>
                                    <td>
                                        <button title="View User Info" class="btn btn-outline-secondary" data-toggle="modal" data-target="#{{ item.user.username }}">
                                            <img src="/static/images/view-file.png" width="20" height="20"/>
                                        </button>
                                        <a href="/update-add-show-user/{{ item.user.id }}/" class="btn btn-outline-secondary" title="Update User Info">
                                            <img src="/static/images/edit-metadata.png" width="20" height="20"/>
                                        </a>
                                        <button title="Delete User" class="btn btn-outline-secondary" data-toggle="modal" data-target="#{{ item.user.id }}">
                                            <i class="far fa-trash-alt fa-lg"></i>
                                        </button>
                                        <a href="/change-user-password/{{ item.user.id }}/" class="btn btn-outline-secondary" title="Change User Password">
                                            <i class="fa fa-key"></i>
                                        </a>
                                    </td>
                                    <td hidden>{{ item.user.id }}</td>
                                    <td hidden>{{ item.user.id }}</td>
                                    <td hidden>{{ item.user.id }}</td>
                                </tr>

                                <!-- Delete User Modal -->
                                <div class="modal fade" tabindex="-1" id="{{ item.user.id }}">
                                    <div class="modal-dialog">
                                      <div class="modal-content">
                                        <div class="modal-header">
                                          <h4 class="modal-title">Delete User</h4>
                                          <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: white">
                                            <span aria-hidden="true">&times;</span>
                                          </button>
                                        </div>
                                        <div class="modal-body">
                                          <p>Are you sure you want to delete "{{ item.user.username }}" user ?</p>
                                        </div>
                                        <div class="modal-footer">
                                          <button type="button" class="btn btn-outline-dark btn-sm" data-dismiss="modal"> <i class="fa fa-times pr-2"></i> Close</button>

                                            <a href="/delete-add-show-user/{{ item.user.id }}/" class="btn btn-outline-danger btn-sm">
                                                <i class="fa fa-trash pr-2"></i> Delete
                                            </a>

                                        </div>
                                      </div>

                                    </div>

                                </div>

                                <!-- View User Modal -->
                                <div class="modal fade" tabindex="-1" id="{{ item.user.username }}">
                                    <div class="modal-dialog">
                                      <div class="modal-content">
                                        <div class="modal-header">
                                          <h4 class="modal-title">User Information</h4>
                                          <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: white">
                                            <span aria-hidden="true">&times;</span>
                                          </button>
                                        </div>
                                        <div class="modal-body">
                                          <p>Username : {{ item.user.username }}</p>
                                            <hr>
                                          {% if item.user.email %}
                                            <p>Email : {{ item.user.email }}</p>
                                            <hr>
                                          {% endif %}
                                          {% if item.group %}
                                            <p>Groups : {{ item.group }}</p>
                                            <hr>
                                          {% endif %}
                                          {% if item.user.is_superuser == True %}
                                            <p>Role : Admin</p>
                                          {% elif item.user.is_staff == True %}
                                            <p>Role : Staff</p>
                                          {% else %}
                                            <p>Role : User</p>
                                          {% endif %}
                                        </div>
                                        <div class="modal-footer">
                                          <button type="button" class="btn btn-outline-dark btn-sm" data-dismiss="modal"> <i class="fa fa-times pr-2"></i> Close</button>
                                        </div>
                                      </div>

                                    </div>

                                </div>

                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>



</body>
<script>


    //Query All input fields
    var form_fields = document.getElementsByTagName('input')
    form_fields[4].placeholder='Enter Username';
    form_fields[5].placeholder='Enter Email';
    form_fields[6].placeholder='Enter Password';
    form_fields[7].placeholder='Confirm Password';

    for (var field in form_fields){
        form_fields[field].className += ' form-control border-primary'
    }
    $(document).ready(function() {
        $(".multiple-select").select2({
            placeholder: "Click here to select groups.",
            closeOnSelect: true,
            tags: true,
            allowClear: true,
            multiple: true,
            tokenSeparators: ['/',',',';'," "],
        });
    });
</script>

<script>
    function show_hide_passowrd_in_register_page(cb){
    if(cb.checked){
        document.getElementById("show_hide_text_at_register_page").innerText="Hide password";
        document.getElementById("id_password1").type="text";
        document.getElementById("id_password2").type="text";
    }
    else{
        document.getElementById("show_hide_text_at_register_page").innerText="Show password";
        document.getElementById("id_password1").type="password";
        document.getElementById("id_password2").type="password";
    }
    }

</script>
{% endblock content %}
