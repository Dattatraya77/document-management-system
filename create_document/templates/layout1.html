{% load static %}
{% load tz %}
<!DOCTYPE html>
<head>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Group model cdn -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta/dist/css/bootstrap-select.min.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
          integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.6/css/responsive.dataTables.min.css">

    <link rel="icon" type="image/png" sizes="32x32" href="{% static '/images/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="96x96" href="{% static '/images/favicon-96x96.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static '/images/favicon-16x16.png' %}">

    <link rel="stylesheet" type="text/css" href="{% static '/custom/css/main.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static '/custom/css/sidebar.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static '/custom/css/font-awesome-5.15.2.css' %}">

    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">





    {% if title %}
        <title>Welcome to DMS - {{ title }}</title>
    {% else %}
        <title>Welcome to Document Management System</title>
    {% endif %}

    <style>
        .container-fluid {
            padding-right: 15px !important;
            padding-left: 0px;
        }

        .dataTables_filter input {
            background-color : white !important;
            border-radius : 5px !important;
            height: 30px;
            font-family : -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",
            sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji" !important;

            font-size : 1rem ;
        }
        .dataTables_wrapper {
            font-size: 13px;
            position: relative;
            clear: both;
            *zoom: 1;
            zoom: 1;
        }
        #url_preview{
           width:468px;
           height: 295px;
           margin:0px auto;
        }
        #camera_preview{
           width:468px;
           height: 295px;
           margin:0px auto;
        }
        .swal2-popup-custom {
            width: 25em !important;
            padding: 0.25em !important;
            font-size: 0.9rem !important;
        }
        .swal2-icon.swal2-error {
            border-color: #dc3545 !important;
            color: #dc3545 !important;
        }
        .swal2-styled.swal2-cancel {
            border-radius: 1.25em !important;
            font-size: 1em !important!;
        }
        .swal2-styled.swal2-confirm {
            border-radius: 1.25em !important;
            font-size: 1em !important!;
        }
        #navbarTogglerDemo01{
            background:#fafafa;
            margin-left:60px;
            justify-content: space-between;
            border: 1px solid black;
            border-radius: 10px;
            padding-right:20px;
        }
        .ml-5{
            margin-left:10px !important;
        }
        .mt-2{
            margin-top:0px !important;
        }
         .sol-main-sidebar{
            height:93vh;
            overflow-y: scroll;
            padding-bottom:100px;
        }
            .sol-main-sidebar::-webkit-scrollbar {
            width: 0px;
        }
        .sol-main-sidebar:hover::-webkit-scrollbar {
            width: 14px;
        }

        .sol-main-sidebar::-webkit-scrollbar-track {
             background: #dee2e6;
            border-radius: 5px;
            box-shadow: inset 7px 10px 12px #f0f0f0;
        }

        .sol-main-sidebar::-webkit-scrollbar-thumb {
            background: #82a1c1;
            border-radius: 5px;
        }
        .sol-main-sidebar::-webkit-scrollbar-thumb:hover {
            background: #5da0e7;
          }
        {% block css %}{% endblock %}
    </style>
</head>

<body class="sidebar-mini sidebar-closed sidebar-collapse">

<header class="site-header">

    <nav class="navbar navbar-expand-md navbar-dark bg-steel fixed-top bg-dark">
        <a class="navbar-brand text-bold" href="{% url 'search_dashboard' %}"><img src="/media/profile_pics/DMS_logo.png" width="35" class="d-inline-block align-top" alt=""></a>

        <div class="container collapse" id="navbarSupportedContent">
            <button class="mr-3 btn btn-sm btn-light pushmenu btn-menu" role="button"><i class="fas fa-bars"></i></button>

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggle" aria-controls="navbarToggle" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <input type="hidden" id="client_name" value="{{ client_name|lower }}">
            <input type="hidden" id="current_site_domain" value="{{ current_site_domain }}">

            <div class="collapse navbar-collapse" id="navbarToggle">

                <div class="navbar-nav mr-auto">
                    <a class="navbar-brand" href="{% url 'search_dashboard' %}">Document Management System</a>
                </div>
                {% if client_company_name %}
                    <div class="navbar-nav mr-5">
                        <a class="navbar-brand" href="{% url 'search_dashboard' %}">{{ client_company_name }}</a>
                    </div>
                {% endif %}
                <div id="total-time-left" title="Session expire time left" class="text-warning pr-2" align="center" hidden></div>
                <!-- Navbar Right Side -->

                <div class="navbar-nav">
                    {% if user.is_authenticated %}

                        {% if client_logo %}
                            <a class="navbar-brand" href="{% url 'search_dashboard' %}" style="margin-right:0px;">
                                <img src="{{ client_logo }}" alt="" height="30">
                            </a>
                        {% else %}
                            <a class="navbar-brand" href="{% url 'search_dashboard' %}" style="margin-right:0px;">{{ client_name|title }}</a>
                        {% endif %}

                        <a onclick="myDropdownAnchor()" title="User Settings" href="#" class="dropbtn navbar-brand" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true"
                                                    aria-expanded="true"><i class="fas fa-user-cog pl-2"></i>
                            <div class="dropleft" role="group" aria-label="First group">
                                <div class="dropdown-menu dropdown-content" id="myDropdown">
                                    <a class="dropdown-item" href="{% url 'profile' %}">
                                        <i class="fas fa-user fa-lg pr-3"></i>
                                        <span class="pl-2">Profile</span>
                                    </a>
                                    <div class="dropdown-divider"></div>
                                    {% csrf_token %}
                                    <a class="dropdown-item user_logout" onclick="user_logout_func('{{ request.user }}')" href="#" id="user_logout">
                                        <i class="fas fa-sign-out-alt fa-lg pr-3"></i>
                                        <span class="pl-2">Logout</span>
                                    </a>
                                </div>
                            </div>
                        </a>

                    {% else %}
                        <a class="nav-item nav-link {% if type == 'login' %}active{% endif %}" href="{% url 'login' %} glyphicon glyphicon-log-in">Login</a>
                        <a class="nav-item nav-link {% if type == 'register' %}active{% endif %}" href="{% url 'register' %}">Register</a>
                        <a class="nav-item nav-link {% if type == 'support' %}active{% endif %}" href="{% url 'register' %}">Support</a>
                        <a class="nav-item nav-link {% if type == 'help' %}active{% endif %}" href="{% url 'register' %}">help</a>
                    {% endif %}
                </div>
            </div>

        </div>
    </nav>
</header>

{% include "sidebar.html" %}

<main role="main" class="container-fluid mt-5 " id="main-box">
    {% if messages %}
        <div class="scroll" id="main_div">
            {% for message in messages %}
            <div class="container-fluid p-0">
              <div class="alert {{ message.tags }} alert-dismissible" role="alert" >
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
                  {{ message }}
              </div>
            </div>
            {% endfor %}
        </div>
    {% endif %}
    {% block content %}{% endblock %}

</main>

<nav class="navbar navbar-expand navbar-light bg-light fixed-bottom py-2">
    <div class=" navbar-collapse" id="navbarTogglerDemo01">
        <ul class="navbar-nav ml-5 mr-auto mt-2 mt-lg-0">
            <li class="nav-item">
                <a style="font-size : 14px;" class="nav-link" href="#">Terms</a>
            </li>

            <li class="nav-item">
                <a style="font-size : 14px;" class="nav-link" href="#">Support</a>
            </li>

            <li class="nav-item">
                <a style="font-size : 14px;" class="nav-link" href="#">Help</a>
            </li>

            <li class="nav-item">
                <a style="font-size : 14px;" class="nav-link" href="#">Privacy</a>
            </li>
        </ul>
        <span  style="font-size : 12px;"> Copyright Â© 2020-<script>document.write(new Date().getFullYear());</script>,
            DMS Inc. ALL RIGHTS RESERVED
        </span>
    </div>
</nav>

<!-- Modal for Loading Spinner-->

<div class="modal" id="loading" data-backdrop="static" data-keyboard="false" tabindex="-1"
     aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-sm">
    <div class="modal-content">
      <div class="modal-body">
          <div class="d-flex">
              <div class="spinner-border text-warning" role="status">
                  <span class="sr-only">Loading...</span>
              </div>
              <h4 class="pl-4">Please wait...</h4>
          </div>
      </div>
    </div>
  </div>
</div>


<!-- Modal for PDF Loading Spinner-->

<div class="modal" id="pdf_loading" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
      <div class="card border-warning mb-3" style="max-width: 18rem;">
          <div class="card-header">
              <div class="spinner-border text-warning" role="status">
                <span class="sr-only"></span>
              </div> <span>Loading...</span>
          </div>
          <div class="card-body">
            <h5 class="card-title">Please wait...</h5>
            <p class="card-text">Working on pdf file conversion.</p>
          </div>
      </div>
  </div>
</div>



<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>



<script>
    $('#sidebarul').css('height',window.outerHeight)

</script>

{% block extracode %}{% endblock %}
{% block extra_media %}
    {{ p_form.media }}
    {{ form.media }}
{% endblock %}
</body>
    <script src="https://cdn.datatables.net/2.0.8/js/dataTables.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.0/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.6/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.0/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.0/js/buttons.print.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/js/bootstrap-select.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/webrtc-adapter/3.3.3/adapter.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.1.10/vue.min.js"></script>
<!--    <script type="text/javascript" src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.3/moment.min.js"></script>
    <script type="text/javascript" src="https://js.live.net/v7.2/OneDrive.js" id="onedrive-js"></script>
    <script src="https://www.appelsiini.net/download/jquery.jeditable.mini.js"></script>

    <script>
        $(document).ready(function() {

            //--------------------------- sidemenu

            $('li.nav-item').mouseleave('click',function(){
              $(this).removeClass('menu-open menu-is-opening');
             $($(this).find("ul")[0]).slideUp()
            })

            $('li.nav-item').on('click',function(){
              $(this).toggleClass('menu-open menu-is-opening');
              $($(this).find("ul")[0]).slideToggle()
            })

            $('.pushmenu').on('click',function(){
              if(window.innerWidth < 750){
                $('body').toggleClass("sidebar-open");
                $('aside.main-sidebar').css('top','55')
              }else{
                $('aside.main-sidebar').css('top','55')
                $('body').toggleClass("sidebar-closed sidebar-collapse");
              }
            })

            $('#example').DataTable({
                responsive: true,
                dom: '<"toolbar"><"float-right pl-3"B>fltip',
                ordering: false,
                stateSave: true,

                buttons: [
                    {
                        extend:    'copyHtml5',
                        text:      '<img src="/static/images/copy.png" width="20" height="20"/>',
                        titleAttr: 'Copy list to clipboard',
                        title: 'DMS_Export_Text'
                    },
                    {
                        extend:    'excelHtml5',
                        text:      '<img src="/static/images/xls.png" width="20" height="20"/>',
                        titleAttr: 'Export list in Excel file format',
                        title: 'DMS_Export_Excel'
                    },
                    {
                        extend:    'csvHtml5',
                        text:      '<img src="/static/images/export-csv.png" width="20" height="20"/>',
                        titleAttr: 'Export list in CSV file format',
                        title: 'DMS_Export_CSV'
                    },
                    {
                        extend:    'pdfHtml5',
                        text:      '<img src="/static/images/pdf.png" width="20" height="20"/>',
                        titleAttr: 'Export list in PDF file format',
                        title: 'DMS_Export_PDF',
                        orientation: 'landscape',
                        pageSize: 'LEGAL',
                        exportOptions: {
                            columns: [ 0, 1, 2, 3, 4, 5 ]
                        }
                    },

                ],
                "language": {
                    "search": '<i style="color:grey" class="fas fa-search" aria-hidden="true">_INPUT_</i>',
                    "searchPlaceholder": "Filter Records",   // Placeholder for the search box
                },

            });

            if(document.getElementById('search-by-meta')){
                $("div.toolbar").html(`
                    <h5 class="d-inline">Matching Documents List</h5><br><br>
                    <div class="pl-3 btn-group" role="group" aria-label="First group">
                        <button type="button" title="Download selected files" class="btn btn-outline-primary btn-sm"
                        onclick="downloadAll('testing.docx')">
                            <i class="fa fa-download" aria-hidden="true"></i>
                        </button>
                    </div>
                    <div class="pl-3 btn-group" role="group" aria-label="First group">
                        <button type="button" title="Add Email Scheduler" class="btn btn-outline-primary btn-sm"
                            onclick="openSchedulerPopup()">
                            <i class="far fa-clock"></i>
                        </button>
                    </div>
                    <div class="pl-3 btn-group" role="group" aria-label="First group">
                        <button type="button" title="Delete selected files" class="btn btn-outline-danger btn-sm"
                            onclick="deleteSelectedFiles()">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `);
            }

            $('#alt-select-file').on('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                $('#file-input').click()

            });

            $('#mobile-alt-select-file').on('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                $('#mobile-file-input').click()

            });


        $('[data-toggle="tooltip"]').tooltip()

        $('.dropzone').on('dragover dragenter dragleave dragend drop', function(e) {
            e.preventDefault();
            e.stopPropagation();
        })

        $('.dropzone').on('dragover dragenter', function(e) {
            $(this).addClass('dragover');
        });

        $('.dropzone').on('dragleave dragend', function(e) {
            $(this).removeClass('dragover');
        });

        $(".dropzone").on('drop', function(e) {

            let x = document.getElementById('file-input')
            x.files = e.originalEvent.dataTransfer.files;
            $('#file-help').html("");

            $.each(x.files , (f) => {
                $('#file-help').append(x.files[f].name + " </br> ")
            });

            $('#file-help').removeClass('d-none');

            $('#upload-hint').html(x.files.length + " files ready to upload");
            $('#upload-btn').removeClass('d-none')
            $('#upload').removeClass('d-none')
            $('#upload').removeAttr('disabled');
            $('#merge_files').attr('disabled',true);

            var e1 = document.getElementById("share-point-api");
            e1.classList.add("link-disabled");

            var e2 = document.getElementById("mobile-alt-select-file");
            e2.classList.add("link-disabled");

            var e3 = document.getElementById("googleapi");
            e3.classList.add("link-disabled");

        });

        $('#file-input').on('change', function(e) {

            let x = document.getElementById('file-input')
            $('#file-help').html("");

            $.each(x.files , (f) => {
                //console.log(x.files[f].name)
                $('#file-help').append(x.files[f].name + " </br> ")
            });

            $('#file-help').removeClass('d-none');

            $('#upload-hint').html( $(this)[0].files.length + " files ready to upload");
            $('#upload-btn').removeClass('d-none');
            $('#upload').removeClass('d-none');
            $('#upload').removeAttr('disabled');

        });
        $('#mobile-file-input').on('change', function(e) {

            let x = document.getElementById('mobile-file-input')
            $('#mobile-file-help').html("");

            $.each(x.files , (f) => {
                //console.log(x.files[f].name)
                $('#mobile-file-help').append(x.files[f].name + " </br> ")
            });

            $('#mobile-file-help').removeClass('d-none');

            $('#upload-hint').html( $(this)[0].files.length + " files ready to upload");
            $('#upload-btn').removeClass('d-none');
            $('#upload').removeClass('d-none');
            $('#upload').removeAttr('disabled');
        });

    });

    function loader(action) {
    if (action === 'show') {
        $('#loading').modal('show');
        $('#loading').attr('inert', ''); // accessibility-safe
    } else {
        document.activeElement?.blur(); // ðŸ‘ˆ key fix
        $('#loading').modal('hide');
        $('#loading').removeAttr('inert');
    }
}


    function pdf_loader(action=null){
        if(action){
            $('#pdf_loading').modal(action);
        } else{
            $('#pdf_loading').modal('hide');
        }
    }

    $(".mul-select").select2({
        placeholder: "Click here to select options.",
        closeOnSelect: true,
        tags: false,
        allowClear: true,
        multiple: true,
        tokenSeparators: ['/',',',';'," "],
    });

    const isEmailRestricted = {{ external_user_email_restriction|yesno:"true,false" }};
    console.log("isEmailRestricted:->",isEmailRestricted);

    $(".mul-select-email").select2({
        placeholder: "Click here to select options.",
        closeOnSelect: true,
        tags: isEmailRestricted ? false : true,
        allowClear: true,
        multiple: true,
        tokenSeparators: ['/',',',';'," "],
    });

    $(".mul-select-users").select2({
        placeholder: "Click here to select users that are notified.",
        closeOnSelect: true,
        tags: false,
        allowClear: true,
        multiple: true,
        tokenSeparators: ['/',',',';'," "],
    });

    $(".selectpicker").select2({
      tags: true
    });
    $(".auto-increment").select2({
      tags: false
    });
    $(".pa-master-metadata").select2({
      tags: true,
    });
    $(".ch-master-metadata").select2({
      tags: false
    });
    $(".choice-master-metadata").select2({
      tags: false
    });
    $(".select2-physical-location").select2({
        tags: false,
        placeholder: "Please Select Document Name",
        closeOnSelect: false,
        allowClear: true,
        multiple: true,
        tokenSeparators: ['/',',',';'," "],
    });
    $(".select-to-select2").select2({
        placeholder: "Please Select Your Choice",
        tags: true,
        closeOnSelect: true,
        allowClear: true,
        multiple: false,
    });

    </script>

    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.7.0/css/buttons.dataTables.min.css">

</html>

{% block extrajs %}
{% endblock %}